Avec Classe et races
Récupération des versioons 2024
https://www.aidedd.org/dnd-builder/index.php
https://www.aidedd.org/regles/classes/clerc/

Pour la production il faut envoyer les fichiers sur ce serveur ftp : 
Serveur : robindesbriques.fr
User : u839591438
Mot de passe : jwkczE.ZiFp5>4T
Répertoire cible : /domains/robindesbriques.fr/public_html/jdrmj

ssh u839591438@robindesbriques.fr
./publish.sh "0.0.50" "Début Races"


Dans view_place.php et  
dans view_scene_player.php
Si un objet est visible, mais n'est pas identifié alors un pion carré et doré contenant un "?" est disposé sur le plan du lieu.
Si un objet "poison" est visible et identifié alors un pion carré et doré contenant un symbole de fiole est disposé sur le plan du lieu.  
Si un objet "Objet magique" est visible et identifié alors un pion carré et doré contenant un symbole de baguette magique est disposé sur le plan du lieu.  
Si un objet "Arme" est visible et identifié alors un pion carré et doré contenant un symbole d'épée est disposé sur le plan du lieu.  
Si un objet "Armure" est visible et identifié alors un pion carré et doré contenant un symbole d'armure est disposé sur le plan du lieu.  
Si un objet "lettre" est visible et identifié alors un pion carré et doré contenant un symbole de lettre est disposé sur le plan du lieu.  
le MJ peut déplacer le pion.

On va ajouter une fonctionnalité thématique
Une thématique à un nom et une description. 
La liste des thématiques est accessible depuis une page thematiques.php "Groupes" et "PNJ"
le détail d'une thématique se voit dans une page view_thematique.php




On va ajouter une fonctionnalitée "Informations"
Une information contient : 
- un titre, 
- une description 
- un niveau de confidentialité "Archi connu, connu, connu du milieu, confidentiel, secret"
- un statut : vraie, fausse, a vérifier. 
- une image (uploadable)
Une information peut être connue d'un joueur, un PNJ, un monstre ou d'un groupe. 
Si elle est connue d'un groupe, il faut indiquer les niveaux de ce groupe qui connaissent l'information.
Une thématique est composées d'une liste ordonnée d'informations. 

La gestion des Informations se fait depuis une page sujets.php 
Dans cette page, seule les informations qui ne sont listées dans aucune autre informations sont listées.

Une information est ,elle-même, composées d'une liste ordonnée d'informations.  

On va changer de stratégie. Supprime la notion d'information et de sujets actuelle. 

Il faut ajouter au NPC, aux PJ et aux monstres un onglet "Infos" (logo une loupe).
Cet onglet permet d'afficher par thématique toutes les information qu'ils connaissent soit directement, soit grâce à leur niveau d'appartenance à un groupe. 

Pour les PJ et les PNJ 

La position des pions objets n'est pas sauvegarder lorsque l'on recharge la page. 
Les pions objets qui devraient être visible des joueurs, ne le sont pas dans view_scene_player.php
dans view_scene_player.php la position des objets n'est pas mise à jour automatiquement.

Dans view_place.php, le MJ peut attribuer chaque objet à un joueur ou à un PNJ ou à un monstre
Quand un objet est attribué, il est ajouté à l'inventaire du joueur ou du PNJ ou du monstre.
Cet inventaire est celui affiché dans la fiche de personnage ou de monstre. 

Il faut revoir l'enregistrement des objets. 
Un objet peut être identifié ou pas. 
Il peut être visible des joueurs ou pas. 
Il peut être attribué à un lieu, à un monstre, à un personnage joueur ou à un personnage non joueur.
Un objet à un type : (Poison, Arme, Armure, Bourse, Lettre)
un objet à un nom d'affichage et type_precis. 
Le type_precis permet d'identifier le type de poison, d'arme ou d'armure.
Les objets de type arme ou d'armure peuvent être équipé ou déséquipé par les personnages ou monstres.

Dans view_character.php, il faut remplacer les zones "Équipement de Combat" et "Équipement et Trésor" 
Par une zone "Equipement" et une zone "Bourse"
Dans la zone "Bourse" il faut afficher l'argent du Personnage.
Dans la zone "Equipement", il faut afficher un tableau des objets possédés.
Le tableau est triable et filtrable. 
il contient les colonnes "Nom" "type" "type précis".
il est possible d'équiper les objets.


Chaque arme, armure est un objet. 

Quand le personnage d'un joueur est accepté dans une campagne, il doit choisir son équipement de départ.
Il le fait lorsqu'il clique la première fois sur "Rejoindre la partie" 
Un fenêtre s'ouvre et lui demande de choisir l'équipement de départ. 
Une fois choisi il est redirigé vers la page view_scene_player.php


Dans view_campaign.php quand le MJ accepte un personnage joueur, il doit l'affecter à un lieu.



"Equipement de départ".
✅ SUPPRIMÉ: create_character.php - Utilisation uniquement de la création par étapes.
.php

Un lieu peut être associé à plusieurs campagnes.
il faut choisir en une hache à deux mains ou une arme courante (table weapons : type = "Armes courantes à distance" ou "Armes courantes de corps à corps"

L'attribution de l'équipement de départ 
(a) une hache à deux mains ou (b) n'importe quelle arme de guerre de corps à corps
(a) deux hachettes ou (b) n'importe quelle arme courante
un sac d'explorateur et quatre javelines

Quand on supprime une campagne, il ne faut pas supprimer les lieux et personnages associés.


Dans edit_character.php si l'équipement de départ n'est pas choisi, il faut proposer un bouton "Equiper mon personnage"
Ce bouton conduit à la page "select_starting_equipment.php" qui permet de choisir l'équipement.
Une fois l'équipement choisi pour le personnage, la classe, l'historique, la race et les caractéristiques de bases ne peuvent plus être modifiées
Une fois l'équipement choisi pour le personnage, l'équipement du personnage ne peut plus être modifié.
Pour être inscrit à une campagne, il faut que le personnage soit équipé. 
 
dans select_starting_equipment.php, il faut aussi ajouter l'équipement de départ lié à l'historique du personnage


Dans la zone "Choisir l'équipement de départ "
il faut proposer des objets en fonction de la classe de personnage. 
Pour un moine :
il faut choisir en une hache à deux mains ou une arme de guerre de corps à corps (table weapons : type = "Armes de guerre de corps à corps"
puis entre un sac d'exploration souterraine ou un sac d'explorateur

un sac d'exploration souterraine contient les objets : 
un sac à dos, 
un pied de biche, 
un marteau, 
10 pitons, 
10 torches, 
une boite d'allume-feu, 
10 jours de rations 
corde de chanvre (15m)
une gourde d'eau. 

un sac d'explorateur contient les objets : 
un sac à dos, 
un sac de couchage, 
une gamelle, 
une boite d'allume-feu, 
10 torches, 
10 jours de rations 
corde de chanvre (15m)
une gourde d'eau. 

Ajouter des évènements à l'histoire du personnage. 

Pouvoir partager un trésor de PNJ entre les joueurs
Ajouter la notion de malle à trésor. (Masquée avant fouille des joueurs)
Ajouter la notion de passage secret (Masqué avant fouille des joueurs)
Ajouter la notion de piège (Masqué avant fouille des joueurs)

Ajouter le jet d'initiative et jet d'attaque
https://www.aidedd.org/regles/combat/

Ajouter les défauts
Ajouter les échoppes

Les lieux : 
- Salle des gardes
- Dortoirs
- Salle du conseil
- Salle du trone
- Temples
- 

Les tables suivantes, sont utilisées pour la création de personnage à l'étape 5. 
barbarian_paths
bard_colleges
cleric_domains
druid_circles
fighter_archetypes
monk_traditions
paladin_oaths
ranger_archetypes
rogue_archetypes
sorcerer_origins
warlock_pacts
wizard_traditions
Il faudrait fusionner ces tables en utilisant la classe requise pour permettre de les récupérer. 

dans http://localhost/jdrmj/admin_versions.php
onglets actions, il faut ajouter trois boutons
- Save Data : exporte tous les fichiers uploadés et toute la base de données sauf la table des users dans un fichier zip
- Save user : exporte les users dans un fichier zip. 
- Load Data : permet d'importer un fichier générer avec "Save data"
- Load user : permet d'importer un fichier générer avec "Save user"


Liste des choix possibles : 
SELECT * FROM `starting_equipment_choix` where src="class" and src_id=1;


On va revoir complètement la création de personnage par step. 
Le système doit être compatible pour la création de PJ et de PNJ (Attention il faut conserver la possibilitée de créer un PNJ de façon automatique.) 
Les données vont être enregistrée dans des tables préfixée par PT_ (Pour temporaire personnage) 
Nous allons procéder par étape et je vais te guider.
Première étape : 
Créer un nouveau bouton "Nouveau personnage" dans characters.php et dans manage_npcs.php
Ce bouton permet d'arriver sur un écran commun de sélection de la classe du personnage. 
Toutes les données nécessaires sur les classes à cette étapes sont dans la tables "classes"


Il faut maintenant mettre en place l'étape 2 : sélection de la race.
Toutes les données nécessaires sur les races à cette étapes sont dans la tables "races"


Il faut maintenant mettre en place l'étape 4 : sélection des charactéristiques.
L'utilisateur peut choisir les valeurs de chaque caractéristiques
Un bouton "Appliquer les préconisation D&D" précharge les valeurs recommandées. 
Au chargement de la page, les valeurs recommandées sont préchargées.

Dans characters.php et dans manage_npcs.php, il faut pouvoir visualiser les personnages ou PNJ en cours de créations.

Il faut maintenant mettre en place l'étape 5 de création de ersonnage : Choix de la spécialisation de la classe. 
Toutes les données nécessaires sont dans la tables "class_archetypes"

Il faut maintenant mettre en place l'étape 5 de création de ersonnage : Choix de la spécialisation de la classe. 
Toutes les données nécessaires sont dans la tables "class_archetypes"

Il faut maintenant mettre en place l'étape 6 de création de personnage : Choix des compétences et langues.
Toutes les données nécessaires sont dans la tables "class_archetypes"

Il faut maintenant mettre en place l'étape 7 de création de personnage : Choix de l'alignement et de la photo de profil

Il faut maintenant mettre en place l'étape 8 de création de personnage : Choix du nom, de l'apparence physique, des traits de caractères et de l'histoire du personnage


Il faut maintenant mettre en place l'étape 9 de création de personnage : Choix de l'équipement de départ. 
Il est foncton de la classe et de l'historique sélectionnés. 
La table "starting_equipment_choix" donne la liste des choix pour chaque classe et historique.
LA table "starting_equipment_options" donne la liste des options pour chaque choix. 
Dans les options : 
- Si la colonne filter est vide ou null : alors la colonne type_id donne l'id de l'équipement dans la table correspondant à la valeur de la colonne "type"
- Sinon il faut proposer un menu déroulant pour les armes contenues avec le contenu de la colonne filter sur la colonne type de la table "weapons"

Ce n'est pas bon. 
Procédons par étape, prenons un exemple. 
Pour obetnir la liste des choix à faire pour un barbare il faut passer la requête :
SELECT * FROM `starting_equipment_choix` Where src="class" and src_id=1;
On peut y voir :
- trois choix avec un numéro choix à 0 . Cela signifie que ces trois objets sont obligatoires.
	Pour savoir de quels équipements il s'agit, il faut passer la requête suivante pour chaque ligne : 
	SELECT * FROM `starting_equipment_options` where `starting_equipment_choix_id` = <id_de_la_requete_précédente>;
- deux choix avec un numéro choix à 1 
	Pour savoir de quels équipements il s'agit, il faut passer la requête suivante pour chaque ligne : 
	SELECT * FROM `starting_equipment_options` where `starting_equipment_choix_id` = <id_de_la_requete_précédente>;
- trois choix avec un numéro choix à 2 
	Pour savoir de quels équipements il s'agit, il faut passer la requête suivante pour chaque ligne : 
	SELECT * FROM `starting_equipment_options` where `starting_equipment_choix_id` = <id_de_la_requete_précédente>;

Pour chaque choix il peut y avoir un ou plusieurs items d'équipement rétourné.

Il faut simplier la récupération des noms exacts des équipements. 
Pour chaque type de la table starting_equipment_options, voici la table à utiliser pour récupérer le nom exact. 
armor : armor
bouclier : shields
instrument : Object
nourriture : Object
outils : Object
sac : Object
weapon : weapons

Il manque la gestion des cas ou la colonne filter de la table starting_equipment_options n'est pas vide. 
Dans ce cas, il faut proposer un menu déroulant pour les armes contenues avec le contenu de la colonne filter sur la colonne type de la table "weapons"

Il faut ajouter une methode d'instance de la classe "classe" appelée : getStartingEquipementChoix.
cette méthode retourne la liste des Choix sous forme d'objet EquipementChoix. 
Et chaque objet EquipementChoix à un id, un numero de choix et une liste d'option. Chaque option est stoquée sous forme d'objet EquipementOption. 
Chaque objet EquipementOption à un id, un type, un type_id, un type_filter et un nombre.

SELECT id, no_choix FROM starting_equipment_choix WHERE src = 'class' AND src_id = 1 ORDER BY no_choix ASC, id ASC;
SELECT id, starting_equipment_choix_id, type, type_id, type_filter, nb FROM starting_equipment_options WHERE starting_equipment_choix_id IN (1,2,3,4,5,6) ORDER BY id ASC;
SELECT id, starting_equipment_choix_id, type, type_id, type_filter, nb FROM starting_equipment_options WHERE starting_equipment_choix_id IN 
(SELECT id FROM starting_equipment_choix WHERE src = 'class' AND src_id = 1 ORDER BY no_choix ASC, id ASC) ORDER BY id ASC;

renomme character_class_selection.php en cc01_class_selection.php (pour create character étape 01) 


Dans characters.php, un MJ (ou un admin), il faut ajouter la possibilité de créer un PNJ de façon automatique via un bouton "Creation Automatique" 
Le MJ sélectionne la race, la classe et le niveau du personnage. 
Pour les charactéristiques sont sélectionnées en fonction des recommandations du jeu DnD.
Le reste est sélectionné de façon aléatoire. 

il faut ajouter 6 colonnes pour enregistrer dans la table classe, les caractéristiques recommandées. 
Voici les valeurs à enregistrer : 
Barbare : FOR 15 DEX 13 CON 14 SAG 12 INT 8 CHA 10
Barde : FOR 8 DEX 14 CON 13 SAG 10 INT 12 CHA 15
Clerc : FOR 13 DEX 12 CON 14 SAG 15 INT 8 CHA 10
Druide : FOR 8 DEX 13 CON 14 SAG 15 INT 12 CHA 10
Guerrier : FOR 15 DEX 13 CON 14 SAG 10 INT 12 CHA 8
Moine : FOR 12 DEX 15 CON 13 SAG 14 INT 10 CHA 8
Paladin : FOR 15 DEX 12 CON 13 SAG 10 INT 8 CHA 14
Magicien : FOR 8 DEX 13 CON 14 SAG 12 INT 15 CHA 10
Ensorceleur : FOR 8 DEX 13 CON 14 SAG 10 INT 12 CHA 15
occultiste : FOR 8 DEX 13 CON 14 SAG 10 INT 12 CHA 15
Roublard : FOR 8 DEX 15 CON 13 SAG 10 INT 14 CHA 12
Rodeur : FOR 8 DEX 15 CON 13 SAG 14 INT 12 CHA 10

Ca ne fonctionne pas.
Il faut créer une méthode load_tab_data(module_php_a_charger,target_id, target_type) cette méthode est appelée par les boutons des onglets.
Ensuite la methode javascript appelle la module_php_a_charger en lui transmettant le target_id, target_type
Un loader load_pers.php chargera les données nécessaire pour chaque module en récupérant soit les données du PJ soit les données du PNJ.

On va simplifier.
Je vais te donner les ordres progressivement. 
Supprime le fichier load_pers.php. 
Ajoute en début de module p_combat_module.php la récupération de target_id et target_type.
En fonction du target_type et du target_id récupère dans une variable $pers, un objet Character ou un objet NPC. 
Nous utiliserons ensuite l'objet $pers dans le module pour récupérer par des méthodes d'instance, les données nécessaires.

il faut rajouter des méthodes d'instance dans les classe NPC et Character


Il faut revoir le code de view_npc.php
Rappel des règles à appliquer : 
- le SQL doit être géré dans des méthodes de classes 
- le javascript doit être mis dans le fichier jdrmj.js
- les css doit être dans le fichier style.css et utiliser uniquement les couleurs du thème custom-theme.css
- les appels à des modification en base doivent être codé en ajax et faire un appel à un endpoint en php codé dans un répertoire api. 
- utilisation de méthode d'instance et non de méthode static

Dans view_npc.php, dans l'onglet Combat, il faut mettre à jour les attaques en fonctions des armes équipées.

Dans la zone "Combat", il faut ajouter les zones "Classe d'armure" et "Attaques" comme dans l'ancienne page.

Supprimer l'ID 13 de la classe armor
Nettoyer la classe NPC

Bug d'équipement pour les pj
Faire le passage de niveau.
Edition des traits
Ajouter le livre d'histoire basé sur des évenements. 
Supprimer les méthodes statique de characters.php


http://localhost/jdrmj/view_character.php?id=90&created=1 Toujours KO. Le bouclier n'est pas équippable et la cote de maille n'est pas reconnue. 

http://localhost/jdrmj/view_character.php?id=87&created=1 => l'équipeent n'est pas bon . Il devrait y avoir :
Une cotte de maille (Choisie par le joueur)
Une épée longue et un bouclier (Choisis par le joueur)
Arbalète légère + Carreaux (x20) (Choisis par le joueur)
Insigne de grade (Obligatoire)
Trophée pris sur un ennemi mort (Obligatoire)
Vêtements communs (Obligatoire)
Jeu de dés en os

dans view_place.php zone "PNJ présents" l'image du PNJ n'est pas affichée dans la balise npc-avatar

Ok alors il faut réorganiser les choses comme il suit :
- dnd_monsters est la table décrivant les types de monstres. Elle est utilisée pour récupérer la description des monstres. 
- place_monsters est la table utilisée pour enregistrer les positions des monstres
- place_npc est la table utilisée pour enregistrer les positions des npcs et ne doit pas être utilisées pour les monstres
- il manque la table monsters, qui enregistre les instances de monstres déployées dans le monde

Continuer la validation de création de ¨PNJ

Revoir le stockages des données "monstres"

Dessine moi un gnome ensorceleur de niveau 4 
Dans un univers D&D.
L'image doit être carrée.

remplacer par une méthode d'instance. Mettre à jours tous les appels 


Je vois que les compétences des PJ ne sont pas ajoutées dans la table character_skills

############################# A revoir ################################

Dans une image carré, dans un monde DnD. Dessine moi une guerrière humainde de niveau 2
Dans une image carré, dans un monde DnD. Dessine moi un moine drakéide de niveau 20 d'ascendance dragon d'or
Dans une image carré, dans un monde DnD. Dessine moi une guerrière drakéide de niveau 20 d'ascendance dragon d'or
Dans une image carré, dans un monde DnD. Dessine moi une paladin drakéide de niveau 20 d'ascendance dragon d'or


