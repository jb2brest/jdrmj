Avec Classe et races
R√©cup√©ration des versioons 2024
https://www.aidedd.org/dnd-builder/index.php
https://www.aidedd.org/regles/classes/clerc/

Pour la production il faut envoyer les fichiers sur ce serveur ftp : 
Serveur : robindesbriques.fr
User : u839591438
Mot de passe : jwkczE.ZiFp5>4T
R√©pertoire cible : /domains/robindesbriques.fr/public_html/jdrmj

ssh u839591438@robindesbriques.fr
./publish.sh "0.0.50" "D√©but Races"


Dans view_place.php et  
dans view_scene_player.php
Si un objet est visible, mais n'est pas identifi√© alors un pion carr√© et dor√© contenant un "?" est dispos√© sur le plan du lieu.
Si un objet "poison" est visible et identifi√© alors un pion carr√© et dor√© contenant un symbole de fiole est dispos√© sur le plan du lieu.  
Si un objet "Objet magique" est visible et identifi√© alors un pion carr√© et dor√© contenant un symbole de baguette magique est dispos√© sur le plan du lieu.  
Si un objet "Arme" est visible et identifi√© alors un pion carr√© et dor√© contenant un symbole d'√©p√©e est dispos√© sur le plan du lieu.  
Si un objet "Armure" est visible et identifi√© alors un pion carr√© et dor√© contenant un symbole d'armure est dispos√© sur le plan du lieu.  
Si un objet "lettre" est visible et identifi√© alors un pion carr√© et dor√© contenant un symbole de lettre est dispos√© sur le plan du lieu.  
le MJ peut d√©placer le pion.

On va ajouter une fonctionnalit√© th√©matique
Une th√©matique √† un nom et une description. 
La liste des th√©matiques est accessible depuis une page thematiques.php "Groupes" et "PNJ"
le d√©tail d'une th√©matique se voit dans une page view_thematique.php




On va ajouter une fonctionnalit√©e "Informations"
Une information contient : 
- un titre, 
- une description 
- un niveau de confidentialit√© "Archi connu, connu, connu du milieu, confidentiel, secret"
- un statut : vraie, fausse, a v√©rifier. 
- une image (uploadable)
Une information peut √™tre connue d'un joueur, un PNJ, un monstre ou d'un groupe. 
Si elle est connue d'un groupe, il faut indiquer les niveaux de ce groupe qui connaissent l'information.
Une th√©matique est compos√©es d'une liste ordonn√©e d'informations. 

La gestion des Informations se fait depuis une page sujets.php 
Dans cette page, seule les informations qui ne sont list√©es dans aucune autre informations sont list√©es.

Une information est ,elle-m√™me, compos√©es d'une liste ordonn√©e d'informations.  

On va changer de strat√©gie. Supprime la notion d'information et de sujets actuelle. 

Il faut ajouter au NPC, aux PJ et aux monstres un onglet "Infos" (logo une loupe).
Cet onglet permet d'afficher par th√©matique toutes les information qu'ils connaissent soit directement, soit gr√¢ce √† leur niveau d'appartenance √† un groupe. 

Pour les PJ et les PNJ 

La position des pions objets n'est pas sauvegarder lorsque l'on recharge la page. 
Les pions objets qui devraient √™tre visible des joueurs, ne le sont pas dans view_scene_player.php
dans view_scene_player.php la position des objets n'est pas mise √† jour automatiquement.

Dans view_place.php, le MJ peut attribuer chaque objet √† un joueur ou √† un PNJ ou √† un monstre
Quand un objet est attribu√©, il est ajout√© √† l'inventaire du joueur ou du PNJ ou du monstre.
Cet inventaire est celui affich√© dans la fiche de personnage ou de monstre. 

Il faut revoir l'enregistrement des objets. 
Un objet peut √™tre identifi√© ou pas. 
Il peut √™tre visible des joueurs ou pas. 
Il peut √™tre attribu√© √† un lieu, √† un monstre, √† un personnage joueur ou √† un personnage non joueur.
Un objet √† un type : (Poison, Arme, Armure, Bourse, Lettre)
un objet √† un nom d'affichage et type_precis. 
Le type_precis permet d'identifier le type de poison, d'arme ou d'armure.
Les objets de type arme ou d'armure peuvent √™tre √©quip√© ou d√©s√©quip√© par les personnages ou monstres.

Dans view_character.php, il faut remplacer les zones "√âquipement de Combat" et "√âquipement et Tr√©sor" 
Par une zone "Equipement" et une zone "Bourse"
Dans la zone "Bourse" il faut afficher l'argent du Personnage.
Dans la zone "Equipement", il faut afficher un tableau des objets poss√©d√©s.
Le tableau est triable et filtrable. 
il contient les colonnes "Nom" "type" "type pr√©cis".
il est possible d'√©quiper les objets.


Chaque arme, armure est un objet. 

Quand le personnage d'un joueur est accept√© dans une campagne, il doit choisir son √©quipement de d√©part.
Il le fait lorsqu'il clique la premi√®re fois sur "Rejoindre la partie" 
Un fen√™tre s'ouvre et lui demande de choisir l'√©quipement de d√©part. 
Une fois choisi il est redirig√© vers la page view_scene_player.php


Dans view_campaign.php quand le MJ accepte un personnage joueur, il doit l'affecter √† un lieu.



"Equipement de d√©part".
‚úÖ SUPPRIM√â: create_character.php - Utilisation uniquement de la cr√©ation par √©tapes.
.php

Un lieu peut √™tre associ√© √† plusieurs campagnes.
il faut choisir en une hache √† deux mains ou une arme courante (table weapons : type = "Armes courantes √† distance" ou "Armes courantes de corps √† corps"

L'attribution de l'√©quipement de d√©part 
(a) une hache √† deux mains ou (b) n'importe quelle arme de guerre de corps √† corps
(a) deux hachettes ou (b) n'importe quelle arme courante
un sac d'explorateur et quatre javelines

Quand on supprime une campagne, il ne faut pas supprimer les lieux et personnages associ√©s.


Dans edit_character.php si l'√©quipement de d√©part n'est pas choisi, il faut proposer un bouton "Equiper mon personnage"
Ce bouton conduit √† la page "select_starting_equipment.php" qui permet de choisir l'√©quipement.
Une fois l'√©quipement choisi pour le personnage, la classe, l'historique, la race et les caract√©ristiques de bases ne peuvent plus √™tre modifi√©es
Une fois l'√©quipement choisi pour le personnage, l'√©quipement du personnage ne peut plus √™tre modifi√©.
Pour √™tre inscrit √† une campagne, il faut que le personnage soit √©quip√©. 
 
dans select_starting_equipment.php, il faut aussi ajouter l'√©quipement de d√©part li√© √† l'historique du personnage


Dans la zone "Choisir l'√©quipement de d√©part "
il faut proposer des objets en fonction de la classe de personnage. 
Pour un moine :
il faut choisir en une hache √† deux mains ou une arme de guerre de corps √† corps (table weapons : type = "Armes de guerre de corps √† corps"
puis entre un sac d'exploration souterraine ou un sac d'explorateur

un sac d'exploration souterraine contient les objets : 
un sac √† dos, 
un pied de biche, 
un marteau, 
10 pitons, 
10 torches, 
une boite d'allume-feu, 
10 jours de rations 
corde de chanvre (15m)
une gourde d'eau. 

un sac d'explorateur contient les objets : 
un sac √† dos, 
un sac de couchage, 
une gamelle, 
une boite d'allume-feu, 
10 torches, 
10 jours de rations 
corde de chanvre (15m)
une gourde d'eau. 

Ajouter des √©v√®nements √† l'histoire du personnage. 

Pouvoir partager un tr√©sor de PNJ entre les joueurs
Ajouter la notion de malle √† tr√©sor. (Masqu√©e avant fouille des joueurs)
Ajouter la notion de passage secret (Masqu√© avant fouille des joueurs)
Ajouter la notion de pi√®ge (Masqu√© avant fouille des joueurs)

Ajouter le jet d'initiative et jet d'attaque
https://www.aidedd.org/regles/combat/

Ajouter les d√©fauts
Ajouter les √©choppes

Les lieux : 
- Salle des gardes
- Dortoirs
- Salle du conseil
- Salle du trone
- Temples
- 

Les tables suivantes, sont utilis√©es pour la cr√©ation de personnage √† l'√©tape 5. 
barbarian_paths
bard_colleges
cleric_domains
druid_circles
fighter_archetypes
monk_traditions
paladin_oaths
ranger_archetypes
rogue_archetypes
sorcerer_origins
warlock_pacts
wizard_traditions
Il faudrait fusionner ces tables en utilisant la classe requise pour permettre de les r√©cup√©rer. 

dans http://localhost/jdrmj/admin_versions.php
onglets actions, il faut ajouter trois boutons
- Save Data : exporte tous les fichiers upload√©s et toute la base de donn√©es sauf la table des users dans un fichier zip
- Save user : exporte les users dans un fichier zip. 
- Load Data : permet d'importer un fichier g√©n√©rer avec "Save data"
- Load user : permet d'importer un fichier g√©n√©rer avec "Save user"


Liste des choix possibles : 
SELECT * FROM `starting_equipment_choix` where src="class" and src_id=1;


On va revoir compl√®tement la cr√©ation de personnage par step. 
Le syst√®me doit √™tre compatible pour la cr√©ation de PJ et de PNJ (Attention il faut conserver la possibilit√©e de cr√©er un PNJ de fa√ßon automatique.) 
Les donn√©es vont √™tre enregistr√©e dans des tables pr√©fix√©e par PT_ (Pour temporaire personnage) 
Nous allons proc√©der par √©tape et je vais te guider.
Premi√®re √©tape : 
Cr√©er un nouveau bouton "Nouveau personnage" dans characters.php et dans manage_npcs.php
Ce bouton permet d'arriver sur un √©cran commun de s√©lection de la classe du personnage. 
Toutes les donn√©es n√©cessaires sur les classes √† cette √©tapes sont dans la tables "classes"


Il faut maintenant mettre en place l'√©tape 2 : s√©lection de la race.
Toutes les donn√©es n√©cessaires sur les races √† cette √©tapes sont dans la tables "races"


Il faut maintenant mettre en place l'√©tape 4 : s√©lection des charact√©ristiques.
L'utilisateur peut choisir les valeurs de chaque caract√©ristiques
Un bouton "Appliquer les pr√©conisation D&D" pr√©charge les valeurs recommand√©es. 
Au chargement de la page, les valeurs recommand√©es sont pr√©charg√©es.

Dans characters.php et dans manage_npcs.php, il faut pouvoir visualiser les personnages ou PNJ en cours de cr√©ations.

Il faut maintenant mettre en place l'√©tape 5 de cr√©ation de ersonnage : Choix de la sp√©cialisation de la classe. 
Toutes les donn√©es n√©cessaires sont dans la tables "class_archetypes"

Il faut maintenant mettre en place l'√©tape 5 de cr√©ation de ersonnage : Choix de la sp√©cialisation de la classe. 
Toutes les donn√©es n√©cessaires sont dans la tables "class_archetypes"

Il faut maintenant mettre en place l'√©tape 6 de cr√©ation de personnage : Choix des comp√©tences et langues.
Toutes les donn√©es n√©cessaires sont dans la tables "class_archetypes"

Il faut maintenant mettre en place l'√©tape 7 de cr√©ation de personnage : Choix de l'alignement et de la photo de profil

Il faut maintenant mettre en place l'√©tape 8 de cr√©ation de personnage : Choix du nom, de l'apparence physique, des traits de caract√®res et de l'histoire du personnage


Il faut maintenant mettre en place l'√©tape 9 de cr√©ation de personnage : Choix de l'√©quipement de d√©part. 
Il est foncton de la classe et de l'historique s√©lectionn√©s. 
La table "starting_equipment_choix" donne la liste des choix pour chaque classe et historique.
LA table "starting_equipment_options" donne la liste des options pour chaque choix. 
Dans les options : 
- Si la colonne filter est vide ou null : alors la colonne type_id donne l'id de l'√©quipement dans la table correspondant √† la valeur de la colonne "type"
- Sinon il faut proposer un menu d√©roulant pour les armes contenues avec le contenu de la colonne filter sur la colonne type de la table "weapons"

Ce n'est pas bon. 
Proc√©dons par √©tape, prenons un exemple. 
Pour obetnir la liste des choix √† faire pour un barbare il faut passer la requ√™te :
SELECT * FROM `starting_equipment_choix` Where src="class" and src_id=1;
On peut y voir :
- trois choix avec un num√©ro choix √† 0 . Cela signifie que ces trois objets sont obligatoires.
	Pour savoir de quels √©quipements il s'agit, il faut passer la requ√™te suivante pour chaque ligne : 
	SELECT * FROM `starting_equipment_options` where `starting_equipment_choix_id` = <id_de_la_requete_pr√©c√©dente>;
- deux choix avec un num√©ro choix √† 1 
	Pour savoir de quels √©quipements il s'agit, il faut passer la requ√™te suivante pour chaque ligne : 
	SELECT * FROM `starting_equipment_options` where `starting_equipment_choix_id` = <id_de_la_requete_pr√©c√©dente>;
- trois choix avec un num√©ro choix √† 2 
	Pour savoir de quels √©quipements il s'agit, il faut passer la requ√™te suivante pour chaque ligne : 
	SELECT * FROM `starting_equipment_options` where `starting_equipment_choix_id` = <id_de_la_requete_pr√©c√©dente>;

Pour chaque choix il peut y avoir un ou plusieurs items d'√©quipement r√©tourn√©.

Il faut simplier la r√©cup√©ration des noms exacts des √©quipements. 
Pour chaque type de la table starting_equipment_options, voici la table √† utiliser pour r√©cup√©rer le nom exact. 
armor : armor
bouclier : shields
instrument : Object
nourriture : Object
outils : Object
sac : Object
weapon : weapons

Il manque la gestion des cas ou la colonne filter de la table starting_equipment_options n'est pas vide. 
Dans ce cas, il faut proposer un menu d√©roulant pour les armes contenues avec le contenu de la colonne filter sur la colonne type de la table "weapons"

Il faut ajouter une methode d'instance de la classe "classe" appel√©e : getStartingEquipementChoix.
cette m√©thode retourne la liste des Choix sous forme d'objet EquipementChoix. 
Et chaque objet EquipementChoix √† un id, un numero de choix et une liste d'option. Chaque option est stoqu√©e sous forme d'objet EquipementOption. 
Chaque objet EquipementOption √† un id, un type, un type_id, un type_filter et un nombre.

SELECT id, no_choix FROM starting_equipment_choix WHERE src = 'class' AND src_id = 1 ORDER BY no_choix ASC, id ASC;
SELECT id, starting_equipment_choix_id, type, type_id, type_filter, nb FROM starting_equipment_options WHERE starting_equipment_choix_id IN (1,2,3,4,5,6) ORDER BY id ASC;
SELECT id, starting_equipment_choix_id, type, type_id, type_filter, nb FROM starting_equipment_options WHERE starting_equipment_choix_id IN 
(SELECT id FROM starting_equipment_choix WHERE src = 'class' AND src_id = 1 ORDER BY no_choix ASC, id ASC) ORDER BY id ASC;

renomme character_class_selection.php en cc01_class_selection.php (pour create character √©tape 01) 


Dans characters.php, un MJ (ou un admin), il faut ajouter la possibilit√© de cr√©er un PNJ de fa√ßon automatique via un bouton "Creation Automatique" 
Le MJ s√©lectionne la race, la classe et le niveau du personnage. 
Pour les charact√©ristiques sont s√©lectionn√©es en fonction des recommandations du jeu DnD.
Le reste est s√©lectionn√© de fa√ßon al√©atoire. 

il faut ajouter 6 colonnes pour enregistrer dans la table classe, les caract√©ristiques recommand√©es. 
Voici les valeurs √† enregistrer : 
Barbare : FOR 15 DEX 13 CON 14 SAG 12 INT 8 CHA 10
Barde : FOR 8 DEX 14 CON 13 SAG 10 INT 12 CHA 15
Clerc : FOR 13 DEX 12 CON 14 SAG 15 INT 8 CHA 10
Druide : FOR 8 DEX 13 CON 14 SAG 15 INT 12 CHA 10
Guerrier : FOR 15 DEX 13 CON 14 SAG 10 INT 12 CHA 8
Moine : FOR 12 DEX 15 CON 13 SAG 14 INT 10 CHA 8
Paladin : FOR 15 DEX 12 CON 13 SAG 10 INT 8 CHA 14
Magicien : FOR 8 DEX 13 CON 14 SAG 12 INT 15 CHA 10
Ensorceleur : FOR 8 DEX 13 CON 14 SAG 10 INT 12 CHA 15
occultiste : FOR 8 DEX 13 CON 14 SAG 10 INT 12 CHA 15
Roublard : FOR 8 DEX 15 CON 13 SAG 10 INT 14 CHA 12
Rodeur : FOR 8 DEX 15 CON 13 SAG 14 INT 12 CHA 10

Ca ne fonctionne pas.
Il faut cr√©er une m√©thode load_tab_data(module_php_a_charger,target_id, target_type) cette m√©thode est appel√©e par les boutons des onglets.
Ensuite la methode javascript appelle la module_php_a_charger en lui transmettant le target_id, target_type
Un loader load_pers.php chargera les donn√©es n√©cessaire pour chaque module en r√©cup√©rant soit les donn√©es du PJ soit les donn√©es du PNJ.

On va simplifier.
Je vais te donner les ordres progressivement. 
Supprime le fichier load_pers.php. 
Ajoute en d√©but de module p_combat_module.php la r√©cup√©ration de target_id et target_type.
En fonction du target_type et du target_id r√©cup√®re dans une variable $pers, un objet Character ou un objet NPC. 
Nous utiliserons ensuite l'objet $pers dans le module pour r√©cup√©rer par des m√©thodes d'instance, les donn√©es n√©cessaires.

il faut rajouter des m√©thodes d'instance dans les classe NPC et Character


Il faut revoir le code de view_npc.php
Rappel des r√®gles √† appliquer : 
- le SQL doit √™tre g√©r√© dans des m√©thodes de classes 
- le javascript doit √™tre mis dans le fichier jdrmj.js
- les css doit √™tre dans le fichier style.css et utiliser uniquement les couleurs du th√®me custom-theme.css
- les appels √† des modification en base doivent √™tre cod√© en ajax et faire un appel √† un endpoint en php cod√© dans un r√©pertoire api. 
- utilisation de m√©thode d'instance et non de m√©thode static

Dans view_npc.php, dans l'onglet Combat, il faut mettre √† jour les attaques en fonctions des armes √©quip√©es.

Dans la zone "Combat", il faut ajouter les zones "Classe d'armure" et "Attaques" comme dans l'ancienne page.

Supprimer l'ID 13 de la classe armor
Nettoyer la classe NPC

Bug d'√©quipement pour les pj
Faire le passage de niveau.
Edition des traits
Ajouter le livre d'histoire bas√© sur des √©venements. 
Supprimer les m√©thodes statique de characters.php


http://localhost/jdrmj/view_character.php?id=90&created=1 Toujours KO. Le bouclier n'est pas √©quippable et la cote de maille n'est pas reconnue. 

http://localhost/jdrmj/view_character.php?id=87&created=1 => l'√©quipeent n'est pas bon . Il devrait y avoir :
Une cotte de maille (Choisie par le joueur)
Une √©p√©e longue et un bouclier (Choisis par le joueur)
Arbal√®te l√©g√®re + Carreaux (x20) (Choisis par le joueur)
Insigne de grade (Obligatoire)
Troph√©e pris sur un ennemi mort (Obligatoire)
V√™tements communs (Obligatoire)
Jeu de d√©s en os

dans view_place.php zone "PNJ pr√©sents" l'image du PNJ n'est pas affich√©e dans la balise npc-avatar

Ok alors il faut r√©organiser les choses comme il suit :
- dnd_monsters est la table d√©crivant les types de monstres. Elle est utilis√©e pour r√©cup√©rer la description des monstres. 
- place_monsters est la table utilis√©e pour enregistrer les positions des monstres
- place_npc est la table utilis√©e pour enregistrer les positions des npcs et ne doit pas √™tre utilis√©es pour les monstres
- il manque la table monsters, qui enregistre les instances de monstres d√©ploy√©es dans le monde

Continuer la validation de cr√©ation de ¬®PNJ

Revoir le stockages des donn√©es "monstres"

Dessine moi un gnome ensorceleur de niveau 4 
Dans un univers D&D.
L'image doit √™tre carr√©e.

remplacer par une m√©thode d'instance. Mettre √† jours tous les appels 
85!g5QBMxdMiVZM

Je vois que les comp√©tences des PJ ne sont pas ajout√©es dans la table character_skills

############################# A revoir ################################

Dans une image carr√©, dans un monde DnD. Dessine moi une demi-orc taverni√®re habill√©e en peau de mouton
Dans une image carr√©, dans un monde DnD. Dessine moi un paysan avec sa choppe
Dans une image carr√©, dans un monde DnD. Dessine moi une guerri√®re humainde de niveau 2
Dans une image carr√©, dans un monde DnD. Dessine moi un moine drak√©ide de niveau 20 d'ascendance dragon d'or
Dans une image carr√©, dans un monde DnD. Dessine moi une guerri√®re drak√©ide de niveau 20 d'ascendance dragon d'or
Dans une image carr√©, dans un monde DnD. Dessine moi une paladin drak√©ide de niveau 20 d'ascendance dragon d'or

Dessine moi un plan quadrill√© en noir et blanc, en 2D, vue de dessus d'une cuisine de chateau dans une univers Dnd




Dessine moi un plan quadrill√© en noir et blanc, en 2 dimensions, vue de dessus et dans une univers Dnd (sans texte) : 
un plan d'une route sinueuse bord√©e d'herbe. 
 


Dans un univers dongeon et dragon, dessine moi un bibioth√©caire royal elfe de niveau 17. Sans texte.
PNJ de niveau 17 - Haut-elfe Magicien. Analytique et logique




üìö Savoirs et archives
Biblioth√®que royale : regorge de grimoires, cartes anciennes et secrets interdits

Salle des archives : documents historiques, g√©n√©alogies, trait√©s diplomatiques

Observatoire : utilis√© par les astrologues et les mages du palais

üßô‚Äç‚ôÇÔ∏è Magie et myst√®res
Sanctuaire des arcanes : r√©serv√© aux mages du royaume

Salle des reliques : objets magiques anciens, parfois maudits

Laboratoire alchimique : potions, exp√©riences, et ingr√©dients rares

üõèÔ∏è Vie quotidienne et confort
Appartements des nobles : chambres pour les invit√©s de haut rang

Salle de bal : pour les f√™tes, les intrigues et les danses masqu√©es

Salon de musique : instruments rares, parfois enchant√©s

Jardin int√©rieur : avec fontaines, plantes exotiques, et peut-√™tre des f√©es

üõ°Ô∏è S√©curit√© et d√©fense
Salle des gardes : dortoirs, armurerie, et salle de briefing

Armurerie royale : armes l√©gendaires et √©quipements enchant√©s

Prison secr√®te : pour les tra√Ætres ou les cr√©atures dangereuses

Salle des portails : acc√®s magique vers d'autres lieux ou plans

üç∑ Intendance et logistique
Cuisine royale : vaste, avec fours magiques et ingr√©dients exotiques

Cellier et cave √† vin : pour les banquets et les potions

Salle du personnel d‚Äôintendance : gestion des stocks et des fournitures

Bureau de l‚Äôintendant en chef : registre des d√©penses, cartes logistiques

üïµÔ∏è‚Äç‚ôÇÔ∏è Secrets et passages
Passages secrets : reliant les pi√®ces cl√©s du palais

Salle des murmures : enchant√©e pour espionner les conversations

Chambre oubli√©e : vestige d‚Äôun ancien r√®gne ou d‚Äôun pacte interdit


